import boto3
import s3fs
import pandas as pd

print("Loading AWS credentials from file...")

creds_file="aws_creds.txt"

creds={}

try:
    with open(creds_file,"r") as f:
        for line in f:
            line=line.strip()
            if not line or "=" not in line:
                continue
            k,v=line.split("=",1)
            creds[k.strip()]=v.strip()

    print("Credentials file loaded")

    required=["AWS_ACCESS_KEY_ID","AWS_SECRET_ACCESS_KEY"]

    for r in required:
        if r not in creds:
            raise ValueError(f"Missing {r} in credentials file")

    print("Access Key:",creds["AWS_ACCESS_KEY_ID"][:4]+"****")
    print("Session Token:", "Present" if "AWS_SESSION_TOKEN" in creds else "None")
    print("Region:",creds.get("AWS_DEFAULT_REGION","Not set"))

    print("Creating boto3 session with file credentials...")

    session=boto3.Session(
        aws_access_key_id=creds["AWS_ACCESS_KEY_ID"],
        aws_secret_access_key=creds["AWS_SECRET_ACCESS_KEY"],
        aws_session_token=creds.get("AWS_SESSION_TOKEN"),
        region_name=creds.get("AWS_DEFAULT_REGION")
    )

    print("Verifying credentials with STS...")

    sts=session.client("sts")
    identity=sts.get_caller_identity()

    print("STS verification successful")
    print("Account:",identity["Account"])
    print("ARN:",identity["Arn"])

    print("Creating s3fs filesystem...")

    fs=s3fs.S3FileSystem(
        key=creds["AWS_ACCESS_KEY_ID"],
        secret=creds["AWS_SECRET_ACCESS_KEY"],
        token=creds.get("AWS_SESSION_TOKEN")
    )

    bucket="your-bucket-name"
    key="path/to/file.csv"
    path=f"s3://{bucket}/{key}"

    print("Checking file:",path)

    if not fs.exists(path):
        raise FileNotFoundError("File not found in S3")

    print("Reading CSV with pandas...")

    with fs.open(path,"rb") as f:
        df=pd.read_csv(f)

    print("CSV loaded successfully")
    print("Shape:",df.shape)
    print(df.head())

except Exception as e:
    print("ERROR occurred")
    print(type(e).__name__)
    print(e)
import boto3
import pandas as pd
from io import BytesIO

print("Starting AWS credential check...")

try:
    print("Creating boto3 session...")
    session=boto3.Session()

    creds=session.get_credentials()

    if creds is None:
        print("NO credentials found")
        raise RuntimeError("AWS credentials not configured")

    frozen=creds.get_frozen_credentials()

    print("Credentials found")
    print("Access Key:",frozen.access_key[:4]+"****")
    print("Session Token:", "Present" if frozen.token else "None")

    print("Verifying credentials with STS...")
    sts=session.client("sts")
    identity=sts.get_caller_identity()

    print("STS verification successful")
    print("Account:",identity["Account"])
    print("ARN:",identity["Arn"])

    print("Creating S3 client...")
    s3=session.client("s3")

    bucket="your-bucket-name"
    key="path/to/file.csv"

    print("Bucket:",bucket)
    print("Key:",key)

    print("Requesting file from S3...")
    obj=s3.get_object(Bucket=bucket,Key=key)

    print("Reading file bytes...")
    data=obj["Body"].read()

    print("Bytes downloaded:",len(data))

    print("Loading into pandas...")
    df=pd.read_csv(BytesIO(data))

    print("CSV loaded successfully")
    print("Shape:",df.shape)
    print(df.head())

except Exception as e:
    print("ERROR occurred")
    print(type(e).__name__)
    print(e)



import boto3
import s3fs
import pandas as pd

print("Starting AWS credential check...")

try:
    print("Creating boto3 session...")
    session=boto3.Session()

    creds=session.get_credentials()
    if creds is None:
        print("NO credentials found")
        raise RuntimeError("AWS credentials not configured")

    frozen=creds.get_frozen_credentials()
    print("Credentials detected")
    print("Access Key:",frozen.access_key[:4]+"****")
    print("Session Token:", "Present" if frozen.token else "None")

    print("Verifying credentials with STS...")
    sts=session.client("sts")
    identity=sts.get_caller_identity()
    print("STS verification successful")
    print("Account:",identity["Account"])
    print("ARN:",identity["Arn"])

    print("Creating s3fs filesystem...")
    fs=s3fs.S3FileSystem()

    bucket="your-bucket-name"
    key="path/to/file.csv"
    path=f"s3://{bucket}/{key}"

    print("Checking if file exists:",path)
    if not fs.exists(path):
        raise FileNotFoundError("File does not exist in S3")

    print("Opening file with s3fs...")
    with fs.open(path,"rb") as f:
        print("Reading CSV into pandas...")
        df=pd.read_csv(f)

    print("CSV loaded successfully")
    print("Shape:",df.shape)
    print(df.head())

except Exception as e:
    print("ERROR occurred")
    print(type(e).__name__)
    print(e)
