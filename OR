import polars as pl

def DOM(year, qtr, fips):
    # Assuming `host`, `username`, `password`, and `filesystem` have been properly set
    tds = fs.ds.dataset(dnaclos, filesystem=fs)
    DOM1 = pl.scan_pyarrow_dataset(tds)
    DOM2 = DOM1.filter(pl.col('fips') == fips).filter(pl.col('year') == year).filter(pl.col('qtr') == qtr)
    Final = DOM2.select(["ui_acct", "fips", "naics2", "naics3", "naics4", "naics6"]).collect()
    Final.rename(columns={"ui_acct": "ui_acct"}, inplace=True)
    return Final













# Add indicator column to df2 before join
df2 = df2.with_columns(pl.lit(True).alias("matched"))

# Left join
joined = df1.join(df2, on=["UI", "state"], how="left")

# Fill nulls in 'matched' with False to indicate no match
joined = joined.with_columns(
    pl.col("matched").fill_null(False)
)

print(joined)
