import plotly.express as px

def animated_bubble_chart(df, output_file="bubble_chart.html"):
    df['naics3'] = df['naics3'].astype(str)
    fig = px.scatter(
        df,
        x="mean",
        y="count",
        size="count",
        color="naics3",
        animation_frame="yr_qtr",
        hover_name="naics3",
        size_max=60,
        labels={"mean": "Mean", "count": "Count", "naics3": "NAICS3"}
    )
    fig.write_html(output_file)
    return output_file




def animated_bubble_chart_clusters(df, output_file="bubble_clusters.html"):
    df['naics3'] = df['naics3'].astype(str)
    fig = px.scatter(
        df,
        x="mean",
        y="count",
        size="count",
        color="naics3",
        animation_frame="yr_qtr",
        hover_name="naics3",
        size_max=60,
        labels={"mean": "Mean", "count": "Count", "naics3": "NAICS3"}
    )
    fig.update_layout(title="Animated Bubble Chart: Clusters (Mean vs Count)")
    fig.write_html(output_file)
    return output_file

def animated_bubble_chart_timeline(df, output_file="bubble_timeline.html"):
    df['naics3'] = df['naics3'].astype(str)
    fig = px.scatter(
        df,
        x="yr_qtr",
        y="mean",
        size="count",
        color="naics3",
        hover_name="naics3",
        size_max=60,
        labels={"yr_qtr": "Quarter", "mean": "Mean", "count": "Count", "naics3": "NAICS3"},
        animation_frame="yr_qtr"  # keeps the animation sequential
    )
    fig.update_layout(title="Animated Bubble Chart: Timeline (Mean over Time)")
    fig.write_html(output_file)
    return output_file
# Generate both HTMLs
animated_bubble_chart_clusters(df, "bubble_clusters.html")
animated_bubble_chart_timeline(df, "bubble_timeline.html")
