# List of all 2-digit FIPS codes (exclude territories if needed)
fips_list = [f"{i:02d}" for i in range(1, 57)]

results = []

for year in range(2020, 2025):
    for fips in fips_list:
        try:
            # Load data for specific year and state FIPS
            D = DOM2(year, fips)

            # Format columns as strings
            D['naics6'] = D['naics6'].astype(str).str.zfill(6)
            D['naics2'] = D['naics2'].astype(str).str.zfill(2)
            D['naics6_prefix'] = D['naics6'].str[:2]

            # Find mismatches
            mismatch_count = (D['naics6_prefix'] != D['naics2']).sum()
            total_count = len(D)

            # Save result
            results.append({
                'year': year,
                'fips': fips,
                'mismatches': mismatch_count,
                'total': total_count,
                'percent_mismatch': round(100 * mismatch_count / total_count, 2) if total_count else 0
            })

        except Exception as e:
            print(f"Error with year {year}, fips {fips}: {e}")

# Convert to DataFrame
import pandas as pd
mismatch_summary = pd.DataFrame(results)
mismatch_summary.sort_values(by='percent_mismatch', ascending=False, inplace=True)

# Show the summary
import ace_tools as tools; tools.display_dataframe_to_user(name="Mismatch Summary", dataframe=mismatch_summary)
