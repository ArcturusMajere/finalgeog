import pandas as pd

# Define your input Excel file
file_path = 'your_file.xlsx'

# Get all sheet names (state abbreviations)
xls = pd.ExcelFile(file_path)
state_tabs = xls.sheet_names

# List to collect processed state DataFrames
dfs = []

for state in state_tabs:
    df = pd.read_excel(file_path, sheet_name=state)
    
    # Create new sector bin
    df['sector_bin'] = df['sector'].apply(lambda x: 'Accommodations' if 'accommodation' in x.lower() else 'Non-Accommodations')
    
    # Sum by yr_qtr and sector_bin
    grouped = df.groupby(['yr_qtr', 'sector_bin'], as_index=False)['count'].sum()
    dfs.append(grouped)

# Concatenate all state DataFrames
national_df = pd.concat(dfs)

# Re-aggregate to get national-level totals
national_cohort = national_df.groupby(['yr_qtr', 'sector_bin'], as_index=False)['count'].sum()

# Preview
print(national_cohort)
df['sector_bin'] = df['sector'].apply(lambda x: 'Accommodations' if x == 'Acc' else 'Non-Accommodations')
