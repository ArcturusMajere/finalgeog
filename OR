import os
import pandas as pd

def csvs_to_df(root_dir):
    frames = []
    for dirpath, _, filenames in os.walk(root_dir):
        for f in filenames:
            if f.lower().endswith(".csv"):
                file_path = os.path.join(dirpath, f)
                try:
                    df = pd.read_csv(file_path)
                except Exception as e:
                    print(f"Skipping {file_path}: {e}")
                    continue

                # infer timeframe from filename, e.g. wage_state_2020_1.csv â†’ 2020Q1
                base = os.path.splitext(f)[0]
                parts = base.split("_")
                # adjust parsing to your naming pattern
                if len(parts) >= 4:
                    year, quarter = parts[2], parts[3]
                    yr_qtr = f"{year}Q{quarter}"
                else:
                    yr_qtr = base  # fallback

                df["yr_qtr"] = yr_qtr
                frames.append(df)

    if not frames:
        return pd.DataFrame()

    big_df = pd.concat(frames, ignore_index=True)
    return big_df
